{% from '_flask_macros.html' import sleep_overlay, loading_overlay %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.5" />
  <title>{{ station.full_name }}: veterna info</title>
  <!-- Tailwind via CDN (no app JS) -->
  <!-- <script src="https://cdn.tailwindcss.com"></script>
  <script src="static/css/tailwind-3-4-17.min.js"></script> -->

  <script data-goatcounter="https://stats.to-ni.dev/count" async src="//stats.to-ni.dev/count.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="../static/js/config.js"></script>
</head>

<script>
  preloadedStatusData =  {{ statusData | tojson }}; 
  stationData =  {{ station | tojson }}; 
  prefsData =  {{ prefs | tojson }}; 
</script>

<body class="min-h-screen bg-indigo-50 text-slate-900" style="min-width:440px"> 
  <div id="header" class="status-ok">
    <div class="relative bg-white" >
    <div class="relative" >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 pb-3 pt-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button
            id="back-btn" class="w-9 h-9 flex items-center justify-center rounded-xl text-slate-600
                  hover:bg-slate-200 active:bg-slate-300 transition" aria-label="Back" >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 class="text-lg leading-tight">
            Vetrna Postaja - <span class="text-xl font-semibold">{{ title }}</span> configuration
          </h1>
        </div>
      </div>

      </div>
    </div>

    <div class="relative flex items-center justify-center w-full h-[30px] overflow-hidden">
      <div class="status-border absolute left-1/2 -translate-x-1/2 w-[96rem] h-full"></div>
    </div>
  </div>

  <!-- Content -->
  <main class="max-w-[100rem] mx-auto px-1 lg:px-6 pt-3 grid gap-6 lg:grid-cols-3 items-start">
   

   

    <!-- Left column: charts + wind rose (same width) -->
    <aside class="lg:col-span-2 grid gap-6">
    
      <div class="relative bg-white rounded-2xl shadow-sm border border-slate-200 p-4">

         <!-- Preview  -->
        <div class="flex flex-col mt-4 w-full">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold text-base">Selected prefs preview:</h3>
          </div>
<!--
prefs:
pref_version:9
error_led_on_time:0
dir_led_on_time:0
spin_led_on_time:0
blink_led_on_time:0
creg_timeout_s:30
send_data_interval:10
n_send_retries:2
sleep_enabled:1
sleep_hour_start:17
sleep_hour_end:6          
-->
        <textarea id="prefsPreview"
          class="border rounded p-2 text-sm font-mono whitespace-pre overflow-auto bg-slate-50 max-h-[18rem] w-full"
          rows="14"
          spellcheck="false"
>prefs:
pref_version:9
creg_timeout_s:30
send_data_interval:10
n_send_retries:2
sleep_enabled:1
sleep_hour_start:18
sleep_hour_end:8
</textarea>

          <!-- Confirm / Send -->
          <div class="mt-3 border rounded p-2">
            <div class="flex items-center justify-between gap-2">
              <div class="flex items-center gap-2">
                <input id="confirmSendPrefs" type="checkbox" class="h-4 w-4">
                <label for="confirmSendPrefs" class="text-sm select-none">
                  Set this preferences to be sent to device
                </label>
              </div>


            <button id="btnSendPrefs"
                    class="border rounded px-3 py-1 text-sm disabled:opacity-50">
              Upload
            </button>
            </div>



            <div class="text-sm mt-2">Preferences to send to station on:
                <span class="font-bold" id="prefPickedUpDate">---</span>
            </div>
          </div>

        </div>

        <div class="p-1 pb-2 flex  gap-4 pr-2">
          <div id="prefs" class="flex flex-col gap-2 w-full"></div>
        </div>

       

        

      </div>

      <div class="relative bg-white rounded-2xl shadow-sm border border-slate-200 p-4">

        <div class="p-1 pb-2 flex  gap-4 pr-2">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold text-base"> Preferences history: </h2>
          </div>
        </div>
        <div id="prefHistory"></div>

        

      </div>

      <div class="relative bg-white rounded-2xl shadow-sm border border-slate-200 p-4">

        <div class="p-1 pb-2 flex  gap-4 pr-2">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold text-base">Raw logs:</h2>
          </div>
        </div>

        <div id="logs-value" 
            class="shrink mt-2 w-full max-w-full p-3 rounded-lg bg-slate-100
                    text-sm font-mono whitespace-pre-wrap break-all">
          <div class="part of log class"> part of log</div>
        </div>

      </div>


    </aside>

     <!-- Right column: device status + (moved) location/status/notes -->
    <section class="lg:col-span-1 grid gap-6">
      <!-- Device Status -->
      <div class="relative rounded-2xl shadow-sm border border-slate-200 bg-white p-4">
        <!--{{ sleep_overlay() }}-->

        <h3 id="double-click-show-detailed"  class="font-semibold mb-3 select-none">Parametri postaje</h3> 
        
        <span id="loading-status-msg">Loading status ...</span>
        
        <!-- Status Bars -->
        <div id="status-graphical-info" class="grid grid-cols-2 gap-3"> </div>
        
        <!-- Status info text values -->
        <div id="status-info" class="mt-4 grid gap-1 text-sm"> </div>

      </div>
    </section>

  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 pb-10 pt-4 text-xs text-slate-400">
    ¬© 2025 Paraglidng Wind Station ¬∑ Made with ‚ù§Ô∏è of ü™Ç
  </footer>
</body>
</html>
